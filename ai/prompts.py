# ai/prompts.py

# ai/prompts.py

# Prompt to verify if a text is a resume
VERIFY_RESUME_PROMPT = """
Проанализируй текст и является ли следующий текст резюме.
Ориентируйся на следующие признаки резюме:

— Наличие персональных данных (ФИО, возраст, дата рождения, контакты, город проживания, гражданство).
— Указание желаемой должности, зарплаты, формата работы.
— Описание опыта работы с указанием компаний, должностей, обязанностей, достижений и технологий.
— Наличие раздела "Образование" с вузом, факультетом и специальностью.
— Перечисление навыков (hard skills, soft skills, языки).
— Дополнительная информация о себе, семье, личных качествах.
— Форматные признаки: разделы с заголовками ("Опыт работы", "Образование", "Навыки"), списки, хронология.

Если большинство этих признаков присутствует → это резюме.
Если текст не имеет структуры резюме (нет опыта работы, образования, контактов и т.д.) → это не резюме.

Ответь в формате JSON с двумя ключами:
- "is_resume": boolean (true, если это резюме, иначе false)
- "title": string (придумай краткое название резюме, например "Senior BI Analyst" или "Junior Frontend Developer", если это резюме, иначе null)

Текст:
---
{text}
---
"""

# Prompt to verify if a text is a vacancy
VERIFY_VACANCY_PROMPT = """
Проанализируй текст и определи, является ли он описанием вакансии.
Ориентируйся на следующие признаки вакансии:

- Название должности/позиции (например, "Разработчик", "Аналитик", "Менеджер").
- Описание компании (чем занимается, ее ценности).
- Требования к кандидату (опыт, навыки, образование).
- Обязанности (что нужно будет делать).
- Условия работы (график, зарплата, бонусы, офис/удаленка).
- Контактная информация для отклика.

Если большинство этих признаков присутствует → это вакансия.
Если текст не содержит четких указаний на должность, требования и обязанности → это не вакансия.

Ответь в формате JSON с двумя ключами:
- "is_vacancy": boolean (true, если это вакансия, иначе false)
- "title": string (извлеки из текста название вакансии, например "Senior Python Developer", если это вакансия, иначе null)

Текст:
---
{text}
---
"""

# Prompt to analyze the match between a resume and a vacancy
ANALYZE_MATCH_PROMPT = """
Проанализируй соответствие резюме и вакансию. Ответь на русском языке.

Проведи анализ и предоставь:
1. Процент соответствия резюме требованиям вакансии (число от 0 до 100) и кол-во полностью покрытых требований из общего кол-ва требований (например, 7 из 9).
2. Список наиболее покрытых требований вакансии с резюме (до 5 пунктов)
3. Список не покрытых требований вакансии (до 5 пунктов)

Вход: 1) ВАКАНСИЯ (полный текст вакансии), 2) РЕЗЮМЕ (полный текст резюме). 3) Параметр alpha (по умолчанию 0.8) — вес ключевых требований.

Шаги (выполняй автоматически):
1) Извлеки все требования из ВАКАНСИЯ как отдельные элементы требований. Требование — фраза/буллет/предложение, выражающее навык, опыт, сертификацию, уровень, обязанность или условие. Удаляй дубли и объединяй очень близкие по смыслу.
2) Классифицируй каждое требование в "key" или "nonkey" по правилам:
   - Пометь как key, если в предложении есть слова/маркер: must|required|обязательно|требуется|minimum|at least|years|degree|сертификат|must have|необходимо|обязателен, или если требование уходит в конкретные числа (min years), уровень (Senior) или диплом.
   - Пометь как key также, если требование встречается в первых 3–5 буллетов/подзаголовках или явно повторяется.
   - Иначе — nonkey.
3) Для каждого требования вычисли importance: default 1.0; если есть слова preferred/желательно/plus — 0.6; если явно must/required/обязательно — 1.0; если формулировка «приветствуется» — 0.5.
4) Для каждого требования вычисли match ∈ [0,1] по РЕЗЮМЕ:
   - Ищи прямые доказательства (точные слова/сертификат/числа) → match=1.0.
   - Для технологий/терминов используй семантическую оценку: сильное соответствие → 0.8–0.99, среднее → 0.4–0.79, слабое упоминание → 0.1–0.39, нет → 0.0.
   - Для "годы опыта": если вакансия требует N лет и резюме содержит M лет, match = min(M/N, 1.0).
   - Для уровней (Senior/Mid/Junior): если уровень в резюме ниже требуемого, давай частичный балл (например Mid при Senior → ~0.6).
   - Для сертификатов/правовых требований: бинарно 1.0 если есть, 0.0 если нет; если в резюме «в процессе» → 0.5.
   - Нормализуй и округли match до 3 знаков.
5) Агрегация:
   coverage_key = (Σ importance_i * match_i) / Σ importance_i по всем key (или 0 если нет key).
   coverage_nonkey = (Σ importance_j * match_j) / Σ importance_j по nonkey (или 0 если нет).
   Если нет key элементов — используй alpha=0.5 вместо входного alpha.
   Итог: score_pct = 100 * (alpha * coverage_key + (1-alpha) * coverage_nonkey).
   Округли score_pct до 1 знака; coverage_* до 3 знаков.

Требования:
 "score_pct": number,            // 0..100, 1 десятичный
 "alpha_used": number,
 "coverage_key": number,         // 0..1
 "coverage_nonkey": number,      // 0..1

Используй alpha=0.8, если не указан.

Дополнительно:
1. Длинна ответа должна быть не более 1200 символов.
2. Можно использовать разные эмодзи для каждого совпадения или несоответствия, чтобы пользователь мог визуально понять и оценить.
3. Если ключеные требования вакансии есть в соответствиях, то необходимо выделить жирным эти пункты и подобрать зеленый эмодзи привлекающий больше внимания на это ключевое соответствие.
4. Если ключеные требования вакансии есть в несоответствиях, то необходимо выделить жирным эти пункты и подобрать красный эмодзи привлекающий больше внимания на это ключевое несоответствие.

Возвращай ровно этот текст — ничего кроме него.

Формат ответа:
ПРОЦЕНТ СООТВЕТСТВИЯ: [score_pct]% ([K] из [N])
СОВПАДЕНИЯ:
- [эмодзи] [текст требования] (importance=[importance*100]% , match=[match*100]%)
...
НЕСООТВЕТСТВИЯ:
- [эмодзи] [текст требования] (importance=[importance*100]% , match=[match*100]%)
...

Где:
- [K] — количество требований с match >= 0.5, [N] — общее число требований.
- importance и match показываются в целых процентах (округление до ближайшего целого).
- Покажи все требования в двух разделах (совпадения/несоответствия). Сортируй внутри разделов по убыванию importance*match.


РЕЗЮМЕ:
---
{resume_text}
---

ВАКАНСИЯ:
+++
{vacancy_text}
+++
"""

# Prompt to generate a cover letter
GENERATE_COVER_LETTER_PROMPT = """Н
Напиши сопроводительное письмо для отклика на вакансию, основываясь на Резюме и Вакансии приложенныъ ниже.
Письмо должно быть вежливым, профессиональным и подчеркивать релевантный опыт кандидата.

Ограничения:
1. Длинна ответа не более 1500 символов.
2. Не должно содержать контактов, персональных данных.
3. Никакой воды, только факты.
4. Не должно содержать контактов, персональных данных.
5. Не должно быть призывов к действию.
6. Не должно быть вопросов.

Резюме:
---
{resume_text}
---

Вакансия:
---
{vacancy_text}
---
"""

# Prompt to generate a plan for an HR call
GENERATE_HR_CALL_PLAN_PROMPT = """
Составь план для созвона с HR по данной вакансии, учитывая информацию из резюме. Созвон по длительности 15 минут, вопросы с обеих стороны должны уложиться в эти 15 минут. 
Вопросы от кандидата должны быть структурированы и последовательны, чтобы понимать что его ждет дальше на собеседованиях, что важно, а что нет, чтобы получить ключевые данные.

План должен включать:
1. Краткое представление себя.
2. Примерные вопросы от HR по резюме кандидата. 5-10 вопросов, сформулируй их кратко. Расставь красные флаги для ответов кандидата и приведи правильный пример ответа. Красные флаги должны быть краткими: словами или словосочетаниями. Примеры правильных ответов также должны быть краткими.
3. Вопросы от кандидата к HR по вакансии, команде, отделе, компании, процессам. 5-10 вопросов, сформулируй их кратко. Расставь красные флаги для ответов от HR и приведи правильный пример ответа. И там где важно понимать конкретный ответ но HR его не дала, то нужно добить еще вопросом. Красные флаги должны быть краткими: словами или словосочетаниями. Примеры правильных ответов также должны быть краткими.

Ограничения:
1. Длина ответа не более 3800 символов.
2. Не должно содержать контактов, персональных данных.
3. Никакой воды, только факты.
4. Обязательные вопросы от кандидата: позиция новая или нет, вилка, сколько времени занимает весь процесс найма, когда будет фидбек по текущему созвону.
5. В вопросах от HR не должно быть глубоких технических деталей, вопросы должны быть поверхностными, чаще всего HR своими вопросами лишь подтвердить указанный в резюме конкретный навык или опыт. Особенно если этот навык явно присутствует в вакансии.
6. Можно использовать разные смайлики, чтобы пользователь мог визуально быстро понять и оценить.
7. Не должно быть призывов к действию.

Резюме:
---
{resume_text}
---

Вакансия:
---
{vacancy_text}
---
"""

# Prompt to generate a plan for a technical interview
GENERATE_TECH_INTERVIEW_PLAN_PROMPT = """
Составь подробный план для технического собеседования по данной вакансии, основываясь на резюме.
План должен включать:
1. Возможные технические вопросы от интервьюера по требованиям из вакансии. 10-15 вопросов, сформулируй их кратко. Расставь красные флаги для ответов кандидата и приведи правильный пример ответа. Красные флаги должны быть краткими: словами или словосочетаниями. Примеры правильных ответов также должны быть краткими.
2. Вопросы, которые кандидат должен задать интервьюеру - техническому специалисту по требованиям из вакансии и по работе в этой компании. 10-15 вопросов, сформулируй их кратко. Расставь красные флаги для ответов кандидата и приведи правильный пример ответа. Красные флаги должны быть краткими: словами или словосочетаниями. Примеры правильных ответов также должны быть краткими.



Ограничения:
1. Длина ответа не более 10000 символов.
2. Не должно содержать контактов, персональных данных.
3. Никакой воды, только факты.
4. Обязательные вопросы от кандидата: позиция новая или нет, вилка, сколько времени занимает весь процесс найма, когда будет фидбек по текущему созвону.
5. В вопросах от HR не должно быть глубоких технических деталей, вопросы должны быть поверхностными, чаще всего HR своими вопросами лишь подтвердить указанный в резюме конкретный навык или опыт. Особенно если этот навык явно присутствует в вакансии.
6. Можно использовать разные смайлики, чтобы пользователь мог визуально быстро понять и оценить.
7. Не должно быть призывов к действию.

Резюме:
---
{resume_text}
---

Вакансия:
---
{vacancy_text}
---
"""
